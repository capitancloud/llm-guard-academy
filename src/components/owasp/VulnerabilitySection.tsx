import { motion } from 'framer-motion';
import { AlertTriangle, Lightbulb, BookOpen } from 'lucide-react';
import { OwaspVulnerability } from '@/data/owaspVulnerabilities';
import { cn } from '@/lib/utils';

interface VulnerabilitySectionProps {
  vulnerability: OwaspVulnerability;
  isActive: boolean;
}

const VulnerabilitySection = ({ vulnerability, isActive }: VulnerabilitySectionProps) => {
  const Icon = vulnerability.icon;

  const getAccentColor = (color: string) => {
    switch (color) {
      case 'cyber': return 'text-cyber border-cyber/30 bg-cyber/10';
      case 'warning': return 'text-warning border-warning/30 bg-warning/10';
      case 'danger': return 'text-destructive border-destructive/30 bg-destructive/10';
      case 'success': return 'text-success border-success/30 bg-success/10';
      case 'accent': return 'text-accent border-accent/30 bg-accent/10';
      default: return 'text-cyber border-cyber/30 bg-cyber/10';
    }
  };

  const getIconBg = (color: string) => {
    switch (color) {
      case 'cyber': return 'bg-cyber/20 text-cyber';
      case 'warning': return 'bg-warning/20 text-warning';
      case 'danger': return 'bg-destructive/20 text-destructive';
      case 'success': return 'bg-success/20 text-success';
      case 'accent': return 'bg-accent/20 text-accent';
      default: return 'bg-cyber/20 text-cyber';
    }
  };

  const getGlowClass = (color: string) => {
    switch (color) {
      case 'cyber': return 'shadow-[0_0_30px_hsl(var(--cyber)/0.2)]';
      case 'warning': return 'shadow-[0_0_30px_hsl(var(--warning)/0.2)]';
      case 'danger': return 'shadow-[0_0_30px_hsl(var(--destructive)/0.2)]';
      case 'success': return 'shadow-[0_0_30px_hsl(var(--success)/0.2)]';
      case 'accent': return 'shadow-[0_0_30px_hsl(var(--accent)/0.2)]';
      default: return 'shadow-[0_0_30px_hsl(var(--cyber)/0.2)]';
    }
  };

  return (
    <motion.section
      id={vulnerability.id}
      initial={{ opacity: 0, y: 20 }}
      animate={{ opacity: isActive ? 1 : 0.6, y: 0 }}
      transition={{ duration: 0.3 }}
      className={cn(
        'scroll-mt-8 transition-all duration-300',
        isActive ? 'scale-100' : 'scale-[0.98]'
      )}
    >
      <div className={cn(
        'bg-card rounded-2xl border border-border p-6 md:p-8 transition-shadow duration-300',
        isActive && getGlowClass(vulnerability.color)
      )}>
        {/* Header */}
        <div className="flex items-start gap-4 mb-6">
          <div className={cn(
            'w-14 h-14 rounded-xl flex items-center justify-center flex-shrink-0',
            getIconBg(vulnerability.color)
          )}>
            <Icon className="w-7 h-7" />
          </div>
          <div>
            <div className={cn(
              'inline-flex items-center px-2 py-1 rounded text-xs font-mono font-bold mb-2',
              getAccentColor(vulnerability.color)
            )}>
              LLM{vulnerability.number}
            </div>
            <h2 className="text-2xl md:text-3xl font-bold text-foreground">
              {vulnerability.title}
            </h2>
          </div>
        </div>

        {/* Description */}
        <div className="space-y-6">
          {/* What is it */}
          <div>
            <h3 className="flex items-center gap-2 text-lg font-semibold text-foreground mb-3">
              <BookOpen className="w-5 h-5 text-cyber" />
              Cos'Ã¨
            </h3>
            <p className="text-muted-foreground leading-relaxed pl-7">
              {vulnerability.description}
            </p>
          </div>

          {/* Why dangerous */}
          <div>
            <h3 className="flex items-center gap-2 text-lg font-semibold text-foreground mb-3">
              <AlertTriangle className="w-5 h-5 text-warning" />
              PerchÃ© Ã¨ pericoloso
            </h3>
            <p className="text-muted-foreground leading-relaxed pl-7">
              {vulnerability.whyDangerous}
            </p>
          </div>

          {/* Example */}
          <div className="bg-secondary/50 rounded-xl p-5 border border-border">
            <h3 className="flex items-center gap-2 text-lg font-semibold text-foreground mb-3">
              <Lightbulb className="w-5 h-5 text-accent" />
              Esempio concettuale
            </h3>
            <p className="text-muted-foreground leading-relaxed italic">
              "{vulnerability.example}"
            </p>
          </div>

          {/* Key Points Box */}
          <div className={cn(
            'rounded-xl p-5 border',
            getAccentColor(vulnerability.color)
          )}>
            <h3 className="font-semibold text-foreground mb-4 flex items-center gap-2">
              <span className="text-lg">ðŸ’¡</span>
              Cosa ricordare
            </h3>
            <ul className="space-y-3">
              {vulnerability.keyPoints.map((point, index) => (
                <motion.li
                  key={index}
                  initial={{ opacity: 0, x: -10 }}
                  animate={{ opacity: 1, x: 0 }}
                  transition={{ delay: index * 0.1 }}
                  className="flex items-start gap-3"
                >
                  <span className={cn(
                    'w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold flex-shrink-0 mt-0.5',
                    getIconBg(vulnerability.color)
                  )}>
                    {index + 1}
                  </span>
                  <span className="text-foreground">{point}</span>
                </motion.li>
              ))}
            </ul>
          </div>
        </div>
      </div>
    </motion.section>
  );
};

export default VulnerabilitySection;
